{% from "macros/_form.html" import render_form %}

{% set page_title = _("Dashboard") %}

{% extends "layouts/base_admin.html" %}

{% block body %}
<h1>Dashboard</h1>

<div class="col-md-8">
  <div class="panel panel-default">
    <div class="panel-heading"><h3 class="panel-title">Campaigns</h3></div>
    <table class="table" id="campaigns-list">
        <thead>
            <tr>
                <th>Title</th>
                <th>Type</th>
                <th>Targets</th>
                <th>Calls</th>
                <th>Status</th>
            </tr>
        </thead>
        {% for c in campaigns %}
        <tr>
            <td><a href="{{url_for('campaign.launch', campaign_id=c.id)}}">{{c.name}}</a></td>
            <td>{{c.campaign_type_display()}}</td>
            <td>{{c.targets_display()|safe}}</td>
            <td>{{calls_by_campaign[c.id] }}</td>
            <td><span class="glyphicon {% if c.status == 'live' %}glyphicon-play{%elif c.status=='paused'%}glyphicon-pause{%else%}glyphicon-stop{%endif%}"></td>
        </tr>
        {%endfor%}
    </table>
    <div class="panel-body">
        <a class="btn btn-primary" href="{{ url_for('campaign.form') }}">New Campaign</a>
    </div>
  </div>
</div>

<div class="stats col-md-4">
    <div class="panel panel-default">
    <div class="panel-heading"><h3 class="panel-title">Usage Statistics</h3></div>
    <div class="panel-body">
        <div id="calls_by_day"></div>
        <label>Active Phone Numbers: </label>
            <select>
                {% for n in active_phone_numbers %}
                <option>{{n}}</option>
                {%endfor%}
            </select>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {% assets "graph_js" %}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
  {% endassets %}

<script type="text/javascript">
new Chartkick.LineChart(
    'calls_by_day',
    [{'name': 'Calls per Day',
     'data':{ {% for entry in calls_by_day %}
            '{{entry[0]}}': {{entry[1]}}, {%endfor%} }
    }],
    {"library":{"canvasDimensions":{"height":250}}}
);
</script>
{% endblock %}
